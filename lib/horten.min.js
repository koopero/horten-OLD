var H=function(){function a(a,b){var c=/^((\w+:)\/)?\/?((.*?)@)?(([^:\/\s]+)(:(\d+))?)(([^?#]*)(\?([^#]*))?)(#.*)?/,d=c.exec(a),e={};if(e.protocol=d[2]||"",e.slashes=!0,e.auth=d[4]||null,e.host=d[5]||"",e.port=d[8]||null,e.hostname=d[6],e.hash=d[13]||null,e.search=d[11],b&&d[12]){var f=d[12].split("&");e.query={};for(var g=0;g<f.length;g++){var h=f[g].split("=");e.query[h[0]]=h[1]||""}}return e.pathname=d[10],e.path=d[9],e.href=a,e}function b(a){if(a&&a.constructor==b)return a;if(this.constructor!=b)return new b(a);var c,d;c=null==a||void 0==a?"/":Array.isArray(a)?a.join("/"):String(a),"/"!=c&&(c=c.replace(/\/+/g,"/"),"/"!=c.charAt(0,1)&&(c="/"+c),"/"!=c.charAt(c.length-1)&&(c+="/")),d="/"==c?[]:c.substr(1,c.length-2).split("/");for(var e=0;e<d.length;e++)this[e]=d[e];this.slice=function(a,b){return d.slice(a,b)},this.string=c,this.array=d,this.length=d.length}function c(a){var b=this;return b.constructor!=c?c.instance():(a&&"object"==typeof a||(a={}),a.debug&&(b.debug=!0),b.data={},b.meta={},void(__global.__HortenInstance||(__global.__HortenInstance=b)))}function d(a,c){var d=this;"string"==typeof a&&(a={path:a}),"object"==typeof a&&null!=a&&(d.path=b(a.path),d.prefix=b(a.prefix),d.primitive=!!a.primitive,d.horten=a.horten||instance(),a.debug&&(d.debug=!0),"function"==typeof c&&(d.onData=c),a.attach!==!1&&d.attach())}function e(a){a.primitive=!0,this.keepAlive=a.keepAlive,d.call(this,a)}function f(b,c,d){if(this instanceof f)throw new Error("Not a constructor");c||(c={}),c.keepAlive=c.keepAlive!==!1;var h;if("string"!=typeof b){if(Array.isArray(b)){var i,j;for(j=0;j<b.length&&!i;j++)if(i=f(b[j],c,d))return i;throw new Error("No compatible connect method")}throw new Error("parameter unsupported")}h=b,b=a(b,!0),console.log("TRYING CONNNECT",b);var k;if("ws:"==b.protocol){k=new e(c),k.name=h;var i;if("function"!=typeof WebSocket&&"object"!=typeof WebSocket)return!1;k.reconnect=function(){console.log("WebSocket connecting to",b),i=new WebSocket(h,g),k.attachWebSocket(i)}}else if("sockjs:"==b.protocol){if("function"!=typeof SockJS)return void 0;var l="http://"+b.hostname;b.port&&(l+=":"+b.port),l+=b.pathname,k=new e(c),k.name=h,k.reconnect=function(){console.log("SockJS Reconnect",l);var a=new SockJS(l);k.attachSockJSClient(a,b.query.path)}}return k&&k.reconnect?(k.pull(),k.reconnect(),k.attach(),k):void 0}b.prototype.seg=function(a){return this.array[a]},b.prototype.set=function(a,b,d,e,f){return f=f||this.horten||c.instance(),void 0==b?f.set(a,this,d,e):(b=this.append(b),f.set(a,b,d,e))},b.prototype.get=function(a,b){return b=b||this.horten||c.instance(),void 0==a?b.get(this):(a=this.append(a),b.get(a))},b.prototype.append=function(a){return b(this.string+a)},b.prototype.translate=function(a,c){a=b(a);var d=a.string.length;return this.string.substr(0,d)!=a.string?void 0:(c=b(c),a.string==c.string?this:b(c.string+this.string.substr(d)))},b.prototype.is=function(a){return a=b(a),this==a},b.prototype.startsWith=function(a){a=b(a);var c=a.string.length;return this.string.substr(0,c)!=a.string?!1:b(this.string.substr(c))},b.prototype.toString=function(){return this.string},c.instance=function(){return __global.__HortenInstance||(__global.__HortenInstance=new c),__global.__HortenInstance},c.prototype.get=function(a,d){a=b(a);for(var e=this.data,f=a.array,g=f.length,h=0;g>h&&null!=e;h++)e=e[f[h]];return d||(e=c.clone(e)),e},c.setFlags={keepTopology:2,forceListeners:4,replace:8,readOnly:16},c.prototype.set=function(a,d,e,f){function g(a,b,d,f,g){var i,k,l=!1,m=a;if(Array.isArray(a))for(m={},k=0;k<a.length;k++)void 0!==a[k]&&(m[String(k)]=!0);if(e&c.setFlags.replace)for(i in b)i in m||(j(g,f+i+"/",void 0,!0),delete b[i]);for(i in m)void 0===b[i]&&e&c.setFlags.keepTopology||(l=h(i,a[i],b,d&&d._&&d._[i],f+i+"/",g)||l);return l}function h(a,b,d,h,k,l){var n=!1,o=d[a],p=null!=o&&"object"==typeof o,q=null!=b&&"object"==typeof b;return q||o!==b||e&c.setFlags.forceListeners?(p!=q||void 0===o)&&e&c.setFlags.keepTopology?!1:(h&&h.lp&&(l=l.concat(h.lp)),q?(p||(d[a]=o={}),n=g(b,o,h,k,l)||n):(p&&j(l,k,void 0,!0),d[a]=b,n=!0,m.debug&&console.log(f?f.name:"<anon>",k,JSON.stringify(b)),j(l,k,b)),n&&h&&h.lo&&i(h.lo),n):!1}function i(a){for(var b=0;b<a.length;b++){var c=a[b];c!==f&&(c._objectChange={origin:f,method:"set"},m._pendingListeners||(m._pendingListeners=[]),-1==m._pendingListeners.indexOf(c)&&m._pendingListeners.push(c))}}function j(a,b,c,d){for(var e=0;e<a.length;e++){var g=a[e];if(g!==f){g._primitiveChanges||(g._primitiveChanges={});var h={};h=g._primitiveChanges[b]?g._primitiveChanges[b]:g._primitiveChanges[b]={},h.origin=f,d?h.deleted=!0:h.value=c,m._pendingListeners||(m._pendingListeners=[]),-1==m._pendingListeners.indexOf(g)&&m._pendingListeners.push(g)}}}d=b(d),e=parseInt(e);var k,l,m=this,n=!1,o=this.data,p=this.meta,q=[],r=[],s=d.length;if("object"!=typeof a&&0==s)return!1;for(l=0;s-1>l;l++){k=d.seg(l);var t=o[k];if(null==t||"object"!=typeof t){if(e&c.setFlags.keepTopology)return!1;o=o[k]={},n=!0}else o=t;p&&(p.lp&&(q=q.concat(p.lp)),p.lo&&(r=r.concat(p.lo)),p=p._?p._[k]:null)}return p&&(p.lp&&(q=q.concat(p.lp)),p.lo&&(r=r.concat(p.lo))),0==s?n=g(a,o,p,"/",q)||n:(k=d.seg(l),p=p&&p._&&p._[k],n=h(k,a,o,p,d.toString(),q)||n),n&&(i(r),nextTick(function(){m.flush()})),n},c.set=function(a,b,d,e){return c.instance().set(a,b,d,e)},c.get=function(a,b){return c.instance().get(a,b)},c.listen=function(a,b,d){return c.instance().listen(a,b,d)},c.listenPrimitive=function(a,b,d){return c.instance().listenPrimitive(a,b,d)},c.prototype.getMeta=function(a,c){a=b(a);for(var d,e=this.meta,f=0;d=a.seg(f);){if(!e._){if(!c)return void 0;e._={}}e._[d]||(e._[d]={}),e=e._[d],f++}return e},c.prototype.log=function(){var a=Array.prototype.slice.call(arguments);console.log(a.map(String).join("	"))},c.prototype.listen=function(a,c,e){e||(e={}),e.path=b(a);var f=new d(e);return f.callback=c,this.attachListener(f),f},c.prototype.listenPrimitive=function(a,c,e){e||(e={}),e.path=b(a),e.primitive=!0;var f=new d(e);return f.callback=c,this.attachListener(f),f},c.prototype.attachListener=function(a){a.horten&&a.horten!=this?a.horten.removeListener(a):this.removeListener(a);var c=b(a.path);a._attachedToPath=c,a.horten=this;var d=this.getMeta(c,!0),e=a.primitive?"lp":"lo";void 0==d[e]?d[e]=[a]:d[e].push(a)},c.prototype.removeListener=function(a){function c(b){if(e[b]){var c=e[b].indexOf(a);-1!=c&&e[b].splice(c,1),0==e[b].length&&delete e[b]}}if(a.horten&&a.horten!=this)throw"Trying to remove listener attached to different Horten instance";if(a._attachedToPath){var d=b(a._attachedToPath),e=this.getMeta(d,!1);e&&(c("lp"),c("lo")),delete a._attachedToPath}this._pendingListeners&&(this._pendingListeners=this._pendingListeners.filter(function(b){return b!=a}))},c.prototype.flush=function(){var a=this,c=this._pendingListeners;if(c&&c.length)for(var d=0;d<c.length;d++){var e=c[d],f=e._primitiveChanges,g=e._objectChange,h=e.onData,i=b(e.path),j=b(e.prefix);if(delete e._primitiveChanges,delete e._objectChange,"function"==typeof h){if(f)for(var k in f){var l=f[k],m=b(k).translate(i,j);l.deleted?(h.call(e,void 0,m,"delete",l.origin),void 0!==l.value&&h.call(e,l.value,m,"set",l.origin)):h.call(e,l.value,m,"set",l.origin)}g&&h.call(e,a.get(i),j,g.method,g.origin)}}delete this._pendingListeners},c.merge=function(a,d,e,f){function g(a,b){var d,e,g=a;if(Array.isArray(a))for(g={},e=0;e<a.length;e++)void 0!==a[e]&&(g[String(e)]=!0);if(f&c.setFlags.replace)for(d in b)d in g||delete b[d];for(d in g)void 0===b[d]&&f&c.setFlags.keepTopology||h(d,a[d],b)}function h(a,b,d){var e=d[a],h=null!=e&&"object"==typeof e,i=null!=b&&"object"==typeof b;return i||e!==b?(h!=i||void 0===e)&&f&c.setFlags.keepTopology?!1:void(i?(h||(d[a]=e={}),g(b,e)):d[a]=b):!1}e=b(e);var i,j,k=a,l=e.length;if("object"!=typeof a){if("/"==e)return d;typeof a!=typeof d&&(k=a={})}for(j=0;l-1>j;j++)if(i=e.seg(j),null==k[i]||"object"!=typeof k[i]){if(f&c.setFlags.keepTopology)return a;k=k[i]={}}else k=k[i];return 0==l?g(d,k,"/"):(i=e.seg(j),h(i,d,k,e.toString())),a},c.walk=function(a,d,e){d=b(d);var f=d.array,g=f.length;if(null==a)return void 0;for(var h=0;g>h&&null!=a;h++)a=a[f[h]];return e||(a=c.clone(a)),a},c.clone=function(a){function b(a){var c,d,e={};for(var c in a)d=a[c],e[c]=null!==d&&"object"==typeof d?b(d):d;return e}return"object"==typeof a?b(a):a},c.flatten=function(a,c){function d(a,b){switch(typeof a){case"function":case"undefined":return;case"number":case"string":case"boolean":return void(e[b]=a)}if(null===a)return void(e[b]=null);if(Array.isArray(a))for(var c=0;c<a.length;c++){var f=a[c];"undefined"!=typeof f&&d(f,b+String(c)+"/")}else for(var g in a)d(a[g],b+g+"/")}c=b(c);var e={};return d(a,c.string),e},d.prototype.attach=function(a){var b=this;a&&(b.horten=a),b.horten||(b.horten=instance()),b.horten.attachListener(b)},d.prototype.remove=function(){var a=this;a.horten&&a.horten.removeListener(a)},d.prototype.push=function(){var a=this;if(a.primitive){var c,d=a.horten.get(a.path,!0);d=flatten(d);for(c in d)a.onData(d[c],b(c).translate(null,a.prefix))}else a.onData(a.horten.get(a.path),b(a.prefix),"push",a)},d.prototype.get=function(a){return(void 0==a||null==a)&&(a=this.prefix),a=b(a).translate(this.prefix,this.path),this.horten||(this.horten=instance()),a?this.horten.get(a):void 0},d.prototype.set=function(a,c,d){return(void 0==c||null==c||"/"==c||""==c)&&(c=this.prefix),c=b(c).translate(this.prefix,this.path),this.horten||(this.horten=instance()),c?this.horten.set(a,c,d,this):null},d.prototype.localToGlobalPath=function(a){return b(a).translate(this.prefix,this.path)},d.prototype.globalToLocalPath=function(a){return b(a).translate(this.path,this.prefix)},d.prototype.onData=function(a,b,c,d){"function"==typeof this.callback&&this.callback(a,b,c,d)},d.prototype.setPath=function(a){var c=!!this._attachedToPath;this.remove(),this.path=b(a),c&&this.attach()},inherits(e,d),e.prototype.pull=function(a){var c=this;a=b(a).string,c._pullPaths||(c._pullPaths=[]),-1==c._pullPaths.indexOf(a)&&c._pullPaths.push(a),c._pull()},e.prototype._pull=function(){var a=this;if(a._pullPaths&&a._pullPaths.length&&a.readyToSend()){var b={get:a._pullPaths};a.send(b)&&(a._pullPaths=null)}},e.prototype.push=function(a){var c=this;a=b(a),c._pushData||(c._pushData={}),c._pushData[a]=c.FILL_DATA,c._push()},e.prototype._push=function(){var a=this;if(a._pushData&&a.readyToSend()){var b=!1;for(var c in a._pushData)b=!0,a._pushData[c]==a.FILL_DATA&&(a._pushData[c]=a.get(c));b&&a.send({set:a._pushData}),a._pushData={}}},e.prototype.readyToSend=function(){return!1},e.prototype.onRemoteClose=function(){var a=this;a.keepAlive&&"function"==typeof a.reconnect?(console.log(a.name,"Remote closed, retrying in 1 second"),setTimeout(function(){a.reconnect()},1e3)):(console.log(a.name,"Closed by remote"),a.close())},e.prototype.onData=function(a,b){var c=this;c._pushData||(c._pushData={}),c._pushData[b]=a,c._push()},e.prototype.onRemoteData=function(a){if(this.debug&&console.log(this.name,"RECV",a),"string"==typeof a)try{a=JSON.parse(a)}catch(b){return void console.log(this.name,"Bad JSON from remote")}if(a.set){for(var c in a.set){var d=a.set[c];this.set(d,c)}}a.get&&this.push(a.get)},e.prototype.close=function(){this.remove(),this.keepAlive=!1,"function"==typeof this._close&&this._close()},e.prototype.attachWebSocket=function(a){var b=this;a.onopen=function(){console.log(b.name,"Open WS"),b._push(),b._pull()},a.onerror=function(a){console.log(b.name,"WS error "+JSON.stringify(a))},a.onmessage=function(a){b.onRemoteData(a.data)},a.onclose=function(){b.onRemoteClose()},this.readyToSend=function(){return 1==a.readyState},this.send=function(b){return 1!=a.readyState?!1:(b=JSON.stringify(b),a.send(b),!0)},this._close=function(){a.close()},1==a.readyState&&(b._push(),b._pull())},e.prototype.attachSockJSClient=function(a,c){var d=this;d.sockJS=a,c=b(c).string,a.onopen=function(){a.send(JSON.stringify({path:c}))},a.onmessage=function(b){try{b=JSON.parse(b.data)}catch(c){return console.log(d.name,"Bad JSON in server path response",b),a.close(),void d.onRemoteClose()}b?(d.attachWebSocket(a),d.onRemoteData(b)):(console.log(d.name,"Didn't get path handshake from server"),a.close(),d.onRemoteClose())},a.onclose=function(){console.log(d.name,"Didn't get path handshake from server"),d.onRemoteClose()},a.onerror=function(){}};var g="horten-protocol";return c.Listener=d,c.Client=f,c.Path=b,c}(window);